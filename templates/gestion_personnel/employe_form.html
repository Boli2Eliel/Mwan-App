{% extends 'base.html' %}

{% block page_title %}
    {% if object %}Modifier la Fiche Employé{% else %}Ajouter un Employé{% endif %}
{% endblock %}

{% block page_actions %}
    <a href="{% url 'gestion_personnel:employe_list' %}" class="btn btn-ghost btn-sm">Annuler</a>
    <button type="submit" form="employe-form" class="btn btn-warning btn-sm text-white">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" /></svg>
        Enregistrer
    </button>
{% endblock %}

{% block content %}
<form method="post" id="employe-form" class="bg-white p-6 rounded-lg shadow-sm border border-slate-200" x-data="{ creerCompte: {% if object and not object.utilisateur %}false{% else %}false{% endif %} }">
    {% csrf_token %}
    
    <div class="space-y-8">
        <div>
            <h2 class="text-lg font-semibold text-slate-800 border-b pb-2 mb-6">Informations sur l'Employé</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2">
                <div class="form-control w-full">
                    <label for="{{ form.prenom.id_for_label }}" class="label"><span class="label-text text-slate-600 text-xs">{{ form.prenom.label }}</span></label>
                    {{ form.prenom }}
                    {% if form.prenom.errors %}<div class="label"><span class="label-text-alt text-error">{{ form.prenom.errors.as_text }}</span></div>{% endif %}
                </div>
                <div class="form-control w-full">
                    <label for="{{ form.nom.id_for_label }}" class="label"><span class="label-text text-slate-600 text-xs">{{ form.nom.label }}</span></label>
                    {{ form.nom }}
                    {% if form.nom.errors %}<div class="label"><span class="label-text-alt text-error">{{ form.nom.errors.as_text }}</span></div>{% endif %}
                </div>
                <div class="form-control w-full">
                    <label for="{{ form.poste.id_for_label }}" class="label"><span class="label-text text-slate-600 text-xs">{{ form.poste.label }}</span></label>
                    {{ form.poste }}
                    {% if form.poste.errors %}<div class="label"><span class="label-text-alt text-error">{{ form.poste.errors.as_text }}</span></div>{% endif %}
                </div>
                <div class="form-control w-full">
                    <label for="{{ form.type_contrat.id_for_label }}" class="label"><span class="label-text text-slate-600 text-xs">{{ form.type_contrat.label }}</span></label>
                    {{ form.type_contrat }}
                    {% if form.type_contrat.errors %}<div class="label"><span class="label-text-alt text-error">{{ form.type_contrat.errors.as_text }}</span></div>{% endif %}
                </div>
                <div class="form-control w-full">
                    <label for="{{ form.date_embauche.id_for_label }}" class="label"><span class="label-text text-slate-600 text-xs">{{ form.date_embauche.label }}</span></label>
                    {{ form.date_embauche }}
                    {% if form.date_embauche.errors %}<div class="label"><span class="label-text-alt text-error">{{ form.date_embauche.errors.as_text }}</span></div>{% endif %}
                </div>
                <div class="form-control w-full">
                    <label for="{{ form.telephone.id_for_label }}" class="label"><span class="label-text text-slate-600 text-xs">{{ form.telephone.label }}</span></label>
                    {{ form.telephone }}
                    {% if form.telephone.errors %}<div class="label"><span class="label-text-alt text-error">{{ form.telephone.errors.as_text }}</span></div>{% endif %}
                </div>
                <div class="form-control w-full md:col-span-2">
                    <label for="{{ form.adresse.id_for_label }}" class="label"><span class="label-text text-slate-600 text-xs">{{ form.adresse.label }}</span></label>
                    {{ form.adresse }}
                    {% if form.adresse.errors %}<div class="label"><span class="label-text-alt text-error">{{ form.adresse.errors.as_text }}</span></div>{% endif %}
                </div>
            </div>
        </div>

        <div>
            {% if not object or not object.utilisateur %}
                <div class="form-control">
                  <label class="label cursor-pointer justify-start gap-4">
                    {{ form.creer_compte_utilisateur }}
                    <span class="label-text font-semibold">{{ form.creer_compte_utilisateur.label }}</span> 
                  </label>
                </div>

                <div x-show="creerCompte" x-transition class="mt-4 pl-6 border-l-2 border-amber-200 space-y-2">
                    <h3 class="text-md font-semibold text-slate-700 mb-4">Détails du compte d'accès</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2">
                        {% if form.site %}
                        <div class="form-control w-full">
                            <label for="{{ form.site.id_for_label }}" class="label"><span class="label-text text-slate-600 text-xs">{{ form.site.label }}</span></label>
                            {{ form.site }}
                            {% if form.site.errors %}<div class="label"><span class="label-text-alt text-error">{{ form.site.errors.as_text }}</span></div>{% endif %}
                        </div>
                        {% endif %}
                        <div class="form-control w-full">
                            <label for="{{ form.username.id_for_label }}" class="label"><span class="label-text text-slate-600 text-xs">{{ form.username.label }}</span></label>
                            {{ form.username }}
                            {% if form.username.errors %}<div class="label"><span class="label-text-alt text-error">{{ form.username.errors.as_text }}</span></div>{% endif %}
                        </div>
                        <div class="form-control w-full">
                            <label for="{{ form.email.id_for_label }}" class="label"><span class="label-text text-slate-600 text-xs">{{ form.email.label }}</span></label>
                            {{ form.email }}
                            {% if form.email.errors %}<div class="label"><span class="label-text-alt text-error">{{ form.email.errors.as_text }}</span></div>{% endif %}
                        </div>
                        <div class="form-control w-full">
                            <label for="{{ form.role.id_for_label }}" class="label"><span class="label-text text-slate-600 text-xs">{{ form.role.label }}</span></label>
                            {{ form.role }}
                            {% if form.role.errors %}<div class="label"><span class="label-text-alt text-error">{{ form.role.errors.as_text }}</span></div>{% endif %}
                        </div>
                        <div class="form-control w-full">
                            <label for="{{ form.password.id_for_label }}" class="label"><span class="label-text text-slate-600 text-xs">{{ form.password.label }}</span></label>
                            {{ form.password }}
                            {% if form.password.errors %}<div class="label"><span class="label-text-alt text-error">{{ form.password.errors.as_text }}</span></div>{% endif %}
                        </div>
                    </div>
                </div>
            {% else %}
                <div>
                    <h2 class="text-lg font-semibold text-slate-800 border-b pb-2 mb-6">Compte Utilisateur Associé</h2>
                    <p class="text-sm p-4 bg-slate-100 rounded-md">
                        Cet employé est lié au compte utilisateur : <strong>{{ object.utilisateur.username }}</strong>.
                        <br>La gestion du mot de passe et du rôle se fait via <a href="/admin/utilisateurs/customuser/{{object.utilisateur.pk}}/change/" target="_blank" class="link link-primary">l'interface d'administration</a>.
                    </p>
                </div>
            {% endif %}
        </div>
    </div>
</form>
{% endblock %}